version: "1.5"
services:
  data_manager-nginx:

    image: xiexf128/data_manager-nginx:latest
    #comment the build section if want to download from docker hub
    build:
      context: nginx/
      tags:
        - xiexf128/data_manager-nginx:1.5
        - xiexf128/data_manager-nginx:latest

    restart: always
    volumes:
      - uwsgi_data:/tmp/uwsgi/
      - web_static:/var/www/datamanager/assets/:ro
    ports:
      - "80:80"
    depends_on:
      - data_manager-django
  data_manager-django:
    &django_project
    image: xiexf128/data_manager-django:latest
    #comment the build section if want to download from docker hub
    build:
      context: ./web/
      tags:
        - xiexf128/data_manager-django:1.5
        - xiexf128/data_manager-django:latest
    restart: always
    command: >
      sh -c "/venv/bin/python3 manage.py collectstatic --noinput   && /venv/bin/uwsgi   --ini /app/datamanager.uwsgi.ini --enable-threads"
    env_file:
      - ./.django_secrets.env #change the content of this file
    environment:
      is_docker: "True"
    volumes:
      - uwsgi_data:/tmp/uwsgi/
      - web_static:/app/static/
      - /var/run/docker.sock:/var/run/docker.sock
      - /var/temp/:/app/media/temp/ # volume file conversion
      #add you file/drive settings
      - type: bind
        source: /c/ # default saving everything in C drive root, please change
        target: //app/media//primary_storage #don't change
      - type: bind
        source: /c/ # /d/docker/primary_storage means d:/docker/primary_storage
        target: //app/media//secondary_storage #don't change
      - type: bind
        source: /c/ # linux just use linux folder formate
        target: //app/media//remote_storage #don't change
      - type: bind
        source: /c/ #
        target: //app/media//offline_storage #don't change

  data_manager-JupiterNotebook:
    <<: *django_project
    command: >
      sh -c "/venv/bin/python3 manage.py shell_plus --notebook"
    ports:
      - "8080:8080"

volumes:
  uwsgi_data:
  web_static:
